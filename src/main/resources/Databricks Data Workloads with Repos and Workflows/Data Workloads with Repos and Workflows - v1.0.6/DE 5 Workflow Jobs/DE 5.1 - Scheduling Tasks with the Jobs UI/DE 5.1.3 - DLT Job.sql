{"version":"NotebookV1","origId":2139271331630129,"name":"DE 5.1.3 - DLT Job","language":"sql","commands":[{"version":"CommandV1","origId":2139271331630131,"guid":"df1b1d89-d1a6-4deb-a206-23707fceefd4","subtype":"command","commandType":"auto","position":3.0,"command":"CREATE OR REFRESH STREAMING LIVE TABLE sales_orders_raw\nCOMMENT \"The raw sales orders, ingested from retail-org/sales_orders.\"\nAS\nSELECT * FROM cloud_files(\"${source}/retail-org/sales_orders/\", \"json\", map(\"cloudFiles.inferColumnTypes\", \"true\"))","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"b48ff280-0e06-456e-8224-cdec4b5a1469"},{"version":"CommandV1","origId":2139271331630135,"guid":"b7ebda0e-6579-4b4d-a7c1-579bdfa59db2","subtype":"command","commandType":"auto","position":7.0,"command":"CREATE OR REFRESH LIVE TABLE sales_order_in_chicago\nCOMMENT \"Sales orders in Chicago.\"\nAS\nSELECT city, order_date, customer_id, customer_name, ordered_products_explode.curr, SUM(ordered_products_explode.price) as sales, SUM(ordered_products_explode.qty) as quantity, COUNT(ordered_products_explode.id) as product_count\nFROM (\n  SELECT city, order_date, customer_id, customer_name, EXPLODE(ordered_products) as ordered_products_explode\n  FROM LIVE.sales_orders_cleaned \n  WHERE city = 'Chicago'\n  )\nGROUP BY order_date, city, customer_id, customer_name, ordered_products_explode.curr\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"3b4b26e9-4657-47ec-87fa-d47cd99a960c"},{"version":"CommandV1","origId":2139271331630134,"guid":"2142dd04-066a-4869-a4f0-95c83033fbf4","subtype":"command","commandType":"auto","position":6.0,"command":"CREATE OR REFRESH LIVE TABLE sales_order_in_la\nCOMMENT \"Sales orders in LA.\"\nAS\nSELECT city, order_date, customer_id, customer_name, ordered_products_explode.curr, SUM(ordered_products_explode.price) as sales, SUM(ordered_products_explode.qty) as quantity, COUNT(ordered_products_explode.id) as product_count\nFROM (\n  SELECT city, order_date, customer_id, customer_name, EXPLODE(ordered_products) as ordered_products_explode\n  FROM LIVE.sales_orders_cleaned \n  WHERE city = 'Los Angeles'\n  )\nGROUP BY order_date, city, customer_id, customer_name, ordered_products_explode.curr","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"e91345e9-3abc-43f5-a9ac-9199735945ed"},{"version":"CommandV1","origId":2139271331630130,"guid":"75506784-2c5a-48fc-8e54-ab04483aa0b7","subtype":"command","commandType":"auto","position":2.0,"command":"%run ../Includes/Classroom-Setup-05.1.3","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"d8843684-7f11-4614-8300-826d98f6e54e"},{"version":"CommandV1","origId":2139271331630133,"guid":"45b991a1-4fc1-4264-95bd-759a84d46e37","subtype":"command","commandType":"auto","position":5.0,"command":"CREATE OR REFRESH STREAMING LIVE TABLE sales_orders_cleaned(\n  CONSTRAINT valid_order_number EXPECT (order_number IS NOT NULL) ON VIOLATION DROP ROW\n)\nCOMMENT \"The cleaned sales orders with valid order_number(s) and partitioned by order_datetime.\"\nAS\nSELECT f.customer_id, f.customer_name, f.number_of_line_items, \n  TIMESTAMP(from_unixtime((cast(f.order_datetime as long)))) as order_datetime, \n  DATE(from_unixtime((cast(f.order_datetime as long)))) as order_date, \n  f.order_number, f.ordered_products, c.state, c.city, c.lon, c.lat, c.units_purchased, c.loyalty_segment\n  FROM STREAM(LIVE.sales_orders_raw) f\n  LEFT JOIN LIVE.customers c\n      ON c.customer_id = f.customer_id\n     AND c.customer_name = f.customer_name","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"48c48178-2d15-45c5-b0f1-5e18795f6c17"},{"version":"CommandV1","origId":2139271331630132,"guid":"8b7eef38-2a45-470c-9bdb-c2fd8c40f80e","subtype":"command","commandType":"auto","position":4.0,"command":"CREATE OR REFRESH STREAMING LIVE TABLE customers\nCOMMENT \"The customers buying finished products, ingested from retail-org/customers.\"\nAS SELECT * FROM cloud_files(\"${source}/retail-org/customers/\", \"csv\");","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"fc0dc4bd-f3a1-448d-887f-9f8b153ede65"}],"dashboards":[],"guid":"4597f5cd-e6cd-42e8-a9e8-baabbc1b631a","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{},"reposExportFormat":"SOURCE"}