{"version":"NotebookV1","origId":2139271331630402,"name":"Classroom-Setup-07.2","language":"python","commands":[{"version":"CommandV1","origId":2139271331630403,"guid":"aa0f339e-4396-4f97-9224-ee47c8162aa5","subtype":"command","commandType":"auto","position":2.0,"command":"%run ../../Includes/_common","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"a65b185d-8773-44ff-8290-9c592cb9a1ea"},{"version":"CommandV1","origId":2139271331630404,"guid":"d4f9c493-d635-44f2-b794-2e5c7603a39b","subtype":"command","commandType":"auto","position":3.0,"command":"lesson_config = LessonConfig(name = None,\n                             create_schema = False,\n                             create_catalog = True,\n                             requires_uc = False,\n                             installing_datasets = True,\n                             enable_streaming_support = False,\n                             enable_ml_support = False)\n\nDA = DBAcademyHelper(course_config=course_config,\n                     lesson_config=lesson_config)\nDA.reset_lesson()\nDA.init()\n\nDA.paths.storage_location = f\"{DA.paths.working_dir}/storage_location\"\n\nDA.conclude_setup()","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"3b8d0c0c-8616-4d1c-b3e4-df1c25347169"},{"version":"CommandV1","origId":2139271331630408,"guid":"48d7ecbc-da9e-452d-83a3-45e0b26c529f","subtype":"command","commandType":"auto","position":7.0,"command":"def _generate_user_counts():\n    print_sql(10, f\"\"\"\nUSE CATALOG {DA.catalog_name};              \nUSE SCHEMA {DA.schema_name};\n\nSELECT user_id, count(*) total_records\nFROM user_ping\nGROUP BY user_id\nORDER BY \n  total_records DESC,\n  user_id ASC;\n\"\"\")\n\nDA.generate_user_counts = _generate_user_counts","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"46ea67eb-c661-454d-8e5d-d0e29680084b"},{"version":"CommandV1","origId":2139271331630406,"guid":"872acf05-628a-4689-bda1-6dfbc50af102","subtype":"command","commandType":"auto","position":5.0,"command":"def _generate_config():\n    print_sql(33, f\"\"\"\nCREATE CATALOG IF NOT EXISTS {DA.catalog_name};              \nUSE CATALOG {DA.catalog_name};\n\n\nUSE hive_metastore;\n\n\nCREATE OR REPLACE TABLE user_ping\n(user_id STRING, ping INTEGER, time TIMESTAMP);\n\n\nCREATE OR REPLACE TABLE user_ids (user_id STRING);\n\n\nINSERT INTO user_ids VALUES\n(\"potato_luver\"),\n(\"beanbag_lyfe\"),\n(\"default_username\"),\n(\"the_king\"),\n(\"n00b\"),\n(\"frodo\"),\n(\"data_the_kid\"),\n(\"el_matador\"),\n(\"the_wiz\");\n\n\nCREATE OR REPLACE FUNCTION get_ping()\n    RETURNS INT\n    RETURN int(rand() * 250);\n   \nCREATE OR REPLACE FUNCTION is_active()\n    RETURNS BOOLEAN\n    RETURN CASE\n        WHEN rand() > .25 THEN true\n        ELSE false\n        END;\n\"\"\")\n   \nDA.generate_config = _generate_config\n\n\n\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"0acab6c4-e9ec-4c87-ac9e-015fed92edc2"},{"version":"CommandV1","origId":2139271331630409,"guid":"31cc60c1-cc7b-48b4-9308-ab2b03e77cf7","subtype":"command","commandType":"auto","position":8.0,"command":"def _generate_avg_ping():\n    print_sql(10, f\"\"\"\nUSE CATALOG {DA.catalog_name};              \nUSE SCHEMA {DA.schema_name};\n\nSELECT user_id, window.end end_time, mean(ping) avg_ping\nFROM user_ping\nGROUP BY user_id, window(time, '3 minutes')\nORDER BY\n  end_time DESC,\n  user_id ASC;\n\"\"\")\n\nDA.generate_avg_ping = _generate_avg_ping","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"24fd30ab-7b34-46ad-b169-d04e3060a197"},{"version":"CommandV1","origId":2139271331630405,"guid":"b43a8eaa-5652-4276-822a-2a16346b636f","subtype":"command","commandType":"auto","position":4.0,"command":"def print_sql(rows, sql):\n    html = f\"<textarea style=\\\"width:100%\\\" rows={rows}> \\n{sql.strip()}</textarea>\"\n    displayHTML(html)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"7de24f03-ce37-4d51-a43b-fed845456d6a"},{"version":"CommandV1","origId":2139271331630407,"guid":"f338d86a-3cbf-47de-91f2-d2228a81dfec","subtype":"command","commandType":"auto","position":6.0,"command":"def _generate_load():\n    print_sql(12, f\"\"\"\nUSE CATALOG {DA.catalog_name};              \nUSE SCHEMA {DA.schema_name};\n\nINSERT INTO user_ping\nSELECT *, \n  get_ping() ping, \n  current_timestamp() time\nFROM user_ids\nWHERE is_active()=true;\n\nSELECT * FROM user_ping;\n\"\"\")\n\nDA.generate_load = _generate_load","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"527f834c-7416-46c9-8fc8-9fccb7cc1394"},{"version":"CommandV1","origId":2139271331630410,"guid":"5ba249b3-c202-41a9-b483-b9bda82ee4ba","subtype":"command","commandType":"auto","position":9.0,"command":"def _generate_summary():\n    print_sql(8, f\"\"\"\nUSE CATALOG {DA.catalog_name};              \nUSE SCHEMA {DA.schema_name};\n\nSELECT user_id, min(time) first_seen, max(time) last_seen, count(*) total_records, avg(ping) total_avg_ping\nFROM user_ping\nGROUP BY user_id\nORDER BY user_id ASC;\n\"\"\")\n\nDA.generate_summary = _generate_summary\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"838b7e84-dc29-4577-bee8-88637fe80bb3"}],"dashboards":[],"guid":"dcddd843-fa5f-4760-a9e2-b1d28a570a3c","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{},"reposExportFormat":"SOURCE"}