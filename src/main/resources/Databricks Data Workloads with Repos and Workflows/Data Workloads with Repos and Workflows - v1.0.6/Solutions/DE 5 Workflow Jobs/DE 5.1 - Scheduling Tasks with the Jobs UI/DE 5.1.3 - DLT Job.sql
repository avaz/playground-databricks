{"version":"NotebookV1","origId":2139271331630136,"name":"DE 5.1.3 - DLT Job","language":"sql","commands":[{"version":"CommandV1","origId":2139271331630142,"guid":"b3091170-2ee9-4883-82f5-e5afe9c2e9ca","subtype":"command","commandType":"auto","position":7.0,"command":"CREATE OR REFRESH LIVE TABLE sales_order_in_chicago\nCOMMENT \"Sales orders in Chicago.\"\nAS\nSELECT city, order_date, customer_id, customer_name, ordered_products_explode.curr, SUM(ordered_products_explode.price) as sales, SUM(ordered_products_explode.qty) as quantity, COUNT(ordered_products_explode.id) as product_count\nFROM (\n  SELECT city, order_date, customer_id, customer_name, EXPLODE(ordered_products) as ordered_products_explode\n  FROM LIVE.sales_orders_cleaned \n  WHERE city = 'Chicago'\n  )\nGROUP BY order_date, city, customer_id, customer_name, ordered_products_explode.curr\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"61cd8292-856e-4269-bd51-9a7ce2a6f0c5"},{"version":"CommandV1","origId":2139271331630140,"guid":"cb5568bf-98ce-48c7-9d63-c9e22003da42","subtype":"command","commandType":"auto","position":5.0,"command":"CREATE OR REFRESH STREAMING LIVE TABLE sales_orders_cleaned(\n  CONSTRAINT valid_order_number EXPECT (order_number IS NOT NULL) ON VIOLATION DROP ROW\n)\nCOMMENT \"The cleaned sales orders with valid order_number(s) and partitioned by order_datetime.\"\nAS\nSELECT f.customer_id, f.customer_name, f.number_of_line_items, \n  TIMESTAMP(from_unixtime((cast(f.order_datetime as long)))) as order_datetime, \n  DATE(from_unixtime((cast(f.order_datetime as long)))) as order_date, \n  f.order_number, f.ordered_products, c.state, c.city, c.lon, c.lat, c.units_purchased, c.loyalty_segment\n  FROM STREAM(LIVE.sales_orders_raw) f\n  LEFT JOIN LIVE.customers c\n      ON c.customer_id = f.customer_id\n     AND c.customer_name = f.customer_name","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"e2459f9b-f05d-429c-8052-2594db982ffc"},{"version":"CommandV1","origId":2139271331630137,"guid":"d0ee4d90-b8f4-44e7-883a-effab768df85","subtype":"command","commandType":"auto","position":2.0,"command":"%run ../Includes/Classroom-Setup-05.1.3","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"e0dccc7b-9e5e-43d4-9073-22845dc20a05"},{"version":"CommandV1","origId":2139271331630138,"guid":"7c1d1af9-c52f-4580-9dc4-406f5bd31296","subtype":"command","commandType":"auto","position":3.0,"command":"CREATE OR REFRESH STREAMING LIVE TABLE sales_orders_raw\nCOMMENT \"The raw sales orders, ingested from retail-org/sales_orders.\"\nAS\nSELECT * FROM cloud_files(\"${source}/retail-org/sales_orders/\", \"json\", map(\"cloudFiles.inferColumnTypes\", \"true\"))","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"dbf550e0-d412-4d95-8354-1b04d16def8a"},{"version":"CommandV1","origId":2139271331630141,"guid":"c73c87a2-cd59-48ff-b45c-507cb5583fe3","subtype":"command","commandType":"auto","position":6.0,"command":"CREATE OR REFRESH LIVE TABLE sales_order_in_la\nCOMMENT \"Sales orders in LA.\"\nAS\nSELECT city, order_date, customer_id, customer_name, ordered_products_explode.curr, SUM(ordered_products_explode.price) as sales, SUM(ordered_products_explode.qty) as quantity, COUNT(ordered_products_explode.id) as product_count\nFROM (\n  SELECT city, order_date, customer_id, customer_name, EXPLODE(ordered_products) as ordered_products_explode\n  FROM LIVE.sales_orders_cleaned \n  WHERE city = 'Los Angeles'\n  )\nGROUP BY order_date, city, customer_id, customer_name, ordered_products_explode.curr","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"49509619-7fa8-4eee-a2da-c107f4894a79"},{"version":"CommandV1","origId":2139271331630139,"guid":"7de7b5f7-3a2b-4914-8e18-d2b288943a03","subtype":"command","commandType":"auto","position":4.0,"command":"CREATE OR REFRESH STREAMING LIVE TABLE customers\nCOMMENT \"The customers buying finished products, ingested from retail-org/customers.\"\nAS SELECT * FROM cloud_files(\"${source}/retail-org/customers/\", \"csv\");","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"6279eaee-79a9-4b5b-869e-d4a6f75cdb08"}],"dashboards":[],"guid":"1a811882-3024-404b-8f36-0bc9ea2545da","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{},"reposExportFormat":"SOURCE"}