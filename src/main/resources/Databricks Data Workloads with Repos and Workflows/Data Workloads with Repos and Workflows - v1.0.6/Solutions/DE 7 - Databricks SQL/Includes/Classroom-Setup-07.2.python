{"version":"NotebookV1","origId":2139271331630412,"name":"Classroom-Setup-07.2","language":"python","commands":[{"version":"CommandV1","origId":2139271331630414,"guid":"6b9b2aab-a53f-4a1b-98f0-d011f65409d0","subtype":"command","commandType":"auto","position":3.0,"command":"lesson_config = LessonConfig(name = None,\n                             create_schema = False,\n                             create_catalog = True,\n                             requires_uc = False,\n                             installing_datasets = True,\n                             enable_streaming_support = False,\n                             enable_ml_support = False)\n\nDA = DBAcademyHelper(course_config=course_config,\n                     lesson_config=lesson_config)\nDA.reset_lesson()\nDA.init()\n\nDA.paths.storage_location = f\"{DA.paths.working_dir}/storage_location\"\n\nDA.conclude_setup()","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"559f862c-eebc-4452-8135-77dd7e8f2ee1"},{"version":"CommandV1","origId":2139271331630415,"guid":"b7f5227a-ffbd-4603-bb03-af758e77ac36","subtype":"command","commandType":"auto","position":4.0,"command":"def print_sql(rows, sql):\n    html = f\"<textarea style=\\\"width:100%\\\" rows={rows}> \\n{sql.strip()}</textarea>\"\n    displayHTML(html)","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"e10f5c28-abba-4d4d-b293-38dab9d51551"},{"version":"CommandV1","origId":2139271331630418,"guid":"6f2ef5ed-fb69-49c7-9b88-97e14da26ae4","subtype":"command","commandType":"auto","position":7.0,"command":"def _generate_user_counts():\n    print_sql(10, f\"\"\"\nUSE CATALOG {DA.catalog_name};              \nUSE SCHEMA {DA.schema_name};\n\nSELECT user_id, count(*) total_records\nFROM user_ping\nGROUP BY user_id\nORDER BY \n  total_records DESC,\n  user_id ASC;\n\"\"\")\n\nDA.generate_user_counts = _generate_user_counts","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"c99cc549-8f20-4920-a468-f1703bc3b393"},{"version":"CommandV1","origId":2139271331630417,"guid":"ba70b3eb-61f9-41b6-ae2f-a83ad1b7d880","subtype":"command","commandType":"auto","position":6.0,"command":"def _generate_load():\n    print_sql(12, f\"\"\"\nUSE CATALOG {DA.catalog_name};              \nUSE SCHEMA {DA.schema_name};\n\nINSERT INTO user_ping\nSELECT *, \n  get_ping() ping, \n  current_timestamp() time\nFROM user_ids\nWHERE is_active()=true;\n\nSELECT * FROM user_ping;\n\"\"\")\n\nDA.generate_load = _generate_load","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"4ddedb81-17b0-4e26-852f-a515683fa31a"},{"version":"CommandV1","origId":2139271331630416,"guid":"f0ab8929-d723-4136-87ec-94e3be560401","subtype":"command","commandType":"auto","position":5.0,"command":"def _generate_config():\n    print_sql(33, f\"\"\"\nCREATE CATALOG IF NOT EXISTS {DA.catalog_name};              \nUSE CATALOG {DA.catalog_name};\n\n\nUSE hive_metastore;\n\n\nCREATE OR REPLACE TABLE user_ping\n(user_id STRING, ping INTEGER, time TIMESTAMP);\n\n\nCREATE OR REPLACE TABLE user_ids (user_id STRING);\n\n\nINSERT INTO user_ids VALUES\n(\"potato_luver\"),\n(\"beanbag_lyfe\"),\n(\"default_username\"),\n(\"the_king\"),\n(\"n00b\"),\n(\"frodo\"),\n(\"data_the_kid\"),\n(\"el_matador\"),\n(\"the_wiz\");\n\n\nCREATE OR REPLACE FUNCTION get_ping()\n    RETURNS INT\n    RETURN int(rand() * 250);\n   \nCREATE OR REPLACE FUNCTION is_active()\n    RETURNS BOOLEAN\n    RETURN CASE\n        WHEN rand() > .25 THEN true\n        ELSE false\n        END;\n\"\"\")\n   \nDA.generate_config = _generate_config\n\n\n\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"8707fec7-7ba4-4ba6-8dd6-3e4ea1cc1afc"},{"version":"CommandV1","origId":2139271331630413,"guid":"7412209e-b4f0-4aa4-9002-a63252467c41","subtype":"command","commandType":"auto","position":2.0,"command":"%run ../../Includes/_common","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"2e9384c0-889e-43d1-8e05-1e302246349a"},{"version":"CommandV1","origId":2139271331630419,"guid":"0f59af08-4cb8-480a-b851-7dddfd655d00","subtype":"command","commandType":"auto","position":8.0,"command":"def _generate_avg_ping():\n    print_sql(10, f\"\"\"\nUSE CATALOG {DA.catalog_name};              \nUSE SCHEMA {DA.schema_name};\n\nSELECT user_id, window.end end_time, mean(ping) avg_ping\nFROM user_ping\nGROUP BY user_id, window(time, '3 minutes')\nORDER BY\n  end_time DESC,\n  user_id ASC;\n\"\"\")\n\nDA.generate_avg_ping = _generate_avg_ping","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"b7db1cf8-5525-4a53-8f67-916aba5bd445"},{"version":"CommandV1","origId":2139271331630420,"guid":"2f102007-5bc7-428d-86dd-52a577106b40","subtype":"command","commandType":"auto","position":9.0,"command":"def _generate_summary():\n    print_sql(8, f\"\"\"\nUSE CATALOG {DA.catalog_name};              \nUSE SCHEMA {DA.schema_name};\n\nSELECT user_id, min(time) first_seen, max(time) last_seen, count(*) total_records, avg(ping) total_avg_ping\nFROM user_ping\nGROUP BY user_id\nORDER BY user_id ASC;\n\"\"\")\n\nDA.generate_summary = _generate_summary\n","commandVersion":1,"state":"finished","results":null,"resultDbfsStatus":"INLINED_IN_TREE","resultDbfsErrorMessage":null,"errorSummary":null,"errorTraceType":null,"error":null,"errorDetails":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"metadata":{},"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"tableResultIndex":null,"listResultMetadata":[],"subcommandOptions":null,"contentSha256Hex":null,"nuid":"d6f532c3-6d69-4240-be5e-a373cd0e9872"}],"dashboards":[],"guid":"91ef9679-3b2a-4762-8a27-28a2942856c5","globalVars":{},"iPythonMetadata":null,"inputWidgets":{},"notebookMetadata":{},"reposExportFormat":"SOURCE"}